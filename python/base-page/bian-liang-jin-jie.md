# 变量进阶

## 1 变量的引用

* 变量 和 数据 都是保存在 **内存** 中的
* 在 `Python` 中 **函数 的 参数传递** 以及 **返回值** 都是靠 **引用** 传递的

### 1.1 引用的概念

* **变量** 和 **数据** 是分开存储的
* **数据** 保存在内存中的一个位置
* **变量** 中保存着数据在内存中的地址
* **变量** 中 **记录数据的地址**，就叫做 **引用**
* 使用 `id()` 函数可以查看变量中保存数据所在的 **内存地址**

注意：如果变量已经被定义，当给一个变量赋值的时候，本质上是 **修改了数据的引用**

* 变量 **不再** 对之前的数据引用
* 变量 **改为** 对新赋值的数据引用

### 1.2 变量引用的示例

变量的名字类似于 便签纸 贴在数据上

### 1.3 函数的参数和返回值的传递

```python
def test(num):

    print("在函数内部 %d 对应的内存地址是 %d" % (num, id(num)))

    # 1> 定义一个字符串变量
    result = "hello"

    print("函数要返回数据的内存地址是 %d" % id(result))

    # 2> 将字符串变量返回，返回的是数据的引用，而不是数据本身
    return result

# 1. 定义一个数字的变量
a = 10

# 数据的地址本质上就是一个数字
print("a 变量保存数据的内存地址是 %d" % id(a))

# 2. 调用 test 函数，本质上传递的 是实参保存数据的引用，而不是实参保存的数据！
# 注意：如果函数有返回值，但是没有定义变量接收
# 程序不会报错，但是无法获得返回结果
r = test(a)

print("%s 的内存地址是 %d" % (r, id(r)))

```

## 2 可变和不可变类型

* **不可变类型**，内存中的数据不允许被修改：
  * 数字类型 `int`, `bool`, `float`, `complex`, `long(2.x)`
  * 字符串 `str`
  * 元组 `tuple`
* **可变类型**，内存中的数据可以被修改：
  * 列表 `list`
  * 字典 `dict`

```python
demo_list = [1, 2, 3]

print("定义列表后的内存地址 %d" % id(demo_list))

demo_list.append(999)
demo_list.pop(0)
demo_list.remove(2)
demo_list[0] = 10

print("修改数据后的内存地址 %d" % id(demo_list))

demo_dict = {"name": "小明"}

print("定义字典后的内存地址 %d" % id(demo_dict))

demo_dict["age"] = 18
demo_dict.pop("name")
demo_dict["name"] = "老王"

print("修改数据后的内存地址 %d" % id(demo_dict))
```

> 注意： 字典的 `key` 只能使用不可变类型的数据

1. 可变类型的数据变化，是通过方法来实现的
2. 如果给一个可变类型的变量，赋值了一个新的数据，引用会修改
3. 变量 不再 对之前的数据引用；变量 改为 对新赋值的数据引用

### 哈希(hash)

哈希 接受一个 不可变类型 的数据作为 参数，返回 结果是一个 整数

哈希 是一种 算法，其作用就是提取数据的 特征码（指纹）

设置字典的 **键值对** 时，会首先对 `key` 进行 `hash` 已决定如何在内存中保存字典的数据，以方便 **后续** 对字典的操作：**增、删、改、查**

* 键值对的 `key` 必须是不可变类型数据
* 键值对的 `value` 可以是任意类型的数据

## 3 局部变量和全局变量

局部变量 是在 函数内部 定义的变量，只能在函数内部使用

全局变量 是在 函数外部定义 的变量，所有函数 内部 都可以使用这个变量

### 3.1 局部变量

局部变量 在函数内部使用，同时变量会被内存回收。

#### **3.1.1 局部变量的生命周期**

* 所谓 **生命周期** 就是变量从 **被创建** 到 **被系统回收** 的过程
* **局部变量** 在 **函数执行时** 才会被创建
* **函数执行结束后** 局部变量 **被系统回收**
* **局部变量在生命周期** 内，可以用来存储 **函数内部临时使用到的数据**

### 3.2 全局变量

* **全局变量** 是在 **函数外部定义** 的变量，所有函数内部都可以使用这个变量

**注意**：函数执行时，**需要处理变量时** 会：

1. **首先** 查找 **函数内部** 是否存在 **指定名称 的局部变量**，**如果有，直接使用**
2. 如果没有，查找 **函数外部** 是否存在 **指定名称 的全局变量**，**如果有，直接使用**
3. 如果还没有，程序报错

#### 3.2.1 全局变量注意事项

1. 函数不能直接修改 全局变量的引用\
   全局变量是在 函数外部的定义的 变量，所有函数内部 都可以使用这个变量
2. 在函数内部，可以通过全局变量的引用获取对应的数据
3. 不允许直接修改全局变量的引用 ----- 使用赋值语句修改全局变量的值会在函数内部定义一个局部变量（从而全局变量不会改变，因为函数内的生命周期结束，全局变量的值不会改变。）

#### 3.2.2 在函数内部修改全局变量

在函数中修改全局变量，使用 `global` 进行声明，再使用赋值语句时，不会创建局部变量。

#### 3.2.3 全局变量定义的位置

为了保证所有的函数都能够正确使用到全局变量，应该 将全局变量定义在其他函数的上方

#### 3.2.4 代码结构示意图

|           |
| --------- |
| shebang   |
| import 模块 |
| 全局变量      |
| 函数定义      |
| 执行代码      |

